(()=>{var r=[];let d;function s(e){this.elements=e;for(var o=this,t=o.elements.length-1;0<=t;t--){var s=o.elements[t].getAttribute("data-src"),n=s.split("/").pop();r.push({src:s,name:n,type:"mp4"})}}function n(){for(let t of r){console.log(t);let o=d.transaction("videos_os").objectStore("videos_os").get(t.name);o.addEventListener("success",()=>{var a,e;o.result?(console.log("taking videos from IDB"),c(o.result.video,o.result.name,o.result.src)):(a=t,console.log("Fetching video from network: ",a),e=fetch(a.src).then(e=>e.blob()),Promise.all([e]).then(s=>{console.log("BLOB:",s[0]),c(s[0],a.name,a.src);{s=s[0];var n=a.name,r=a.src;let e=d.transaction(["videos_os"],"readwrite").objectStore("videos_os"),o={video:s,name:n,src:r},t=e.add(o);t.addEventListener("success",()=>console.log("Record addition attempt finished")),t.addEventListener("error",()=>console.error(t.error))}}))})}}function c(e,o,t){var e=URL.createObjectURL(e),s=document.createElement("source");s.src=e,s.type="video/mp4",document.querySelectorAll('[data-src="'+t+'"]')[0].appendChild(s)}window.VideoLoader=s,window.addEventListener("load",function(e){var o=document.getElementsByClassName("js-video-loader");0<o.length&&new s(o);let t=window.indexedDB.open("videos_db",1);t.addEventListener("error",()=>console.error("Database failed to open")),t.addEventListener("success",()=>{console.log("Database opened successfully"),d=t.result,n()}),t.addEventListener("upgradeneeded",e=>{e.target.result.createObjectStore("videos_os",{keyPath:"name"}).createIndex("video","video",{unique:!1}),console.log("Database setup complete")})})})();