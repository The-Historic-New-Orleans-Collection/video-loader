(()=>{var r=[];let d;function s(e){this.elements=e;for(var t=this,o=t.elements.length-1;0<=o;o--){var s=t.elements[o].getAttribute("data-src"),n=s.split("/").pop();r.push({src:s,name:n,type:"mp4"})}}function n(){for(let o of r){console.log(o);let t=d.transaction("videos_os").objectStore("videos_os").get(o.name);t.addEventListener("success",()=>{var a,e;t.result?(console.log("taking videos from IDB"),c(t.result.video,t.result.name,t.result.src)):(a=o,console.log("Fetching video from network: ",a),e=fetch(a.src).then(e=>e.blob()),Promise.all([e]).then(s=>{c(s[0],a.name,a.src);{s=s[0];var n=a.name,r=a.src;let e=d.transaction(["videos_os"],"readwrite").objectStore("videos_os"),t={video:s,name:n,src:r},o=e.add(t);o.addEventListener("success",()=>console.log("Record addition attempt finished")),o.addEventListener("error",()=>console.error(o.error))}}))})}}function c(e,t,o){var e=URL.createObjectURL(e),s=document.createElement("source");s.src=e,s.type="video/mp4",document.querySelectorAll('[data-src="'+o+'"]')[0].appendChild(s)}window.VideoLoader=s,window.addEventListener("load",function(e){var t=document.getElementsByClassName("js-video-loader");0<t.length&&new s(t);let o=window.indexedDB.open("videos_db",1);o.addEventListener("error",()=>console.error("Database failed to open")),o.addEventListener("success",()=>{console.log("Database opened successfully"),d=o.result,n()}),o.addEventListener("upgradeneeded",e=>{e.target.result.createObjectStore("videos_os",{keyPath:"name"}).createIndex("video","video",{unique:!1}),console.log("Database setup complete")})})})();